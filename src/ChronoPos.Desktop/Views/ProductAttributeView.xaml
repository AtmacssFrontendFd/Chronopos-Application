<UserControl x:Class="ChronoPos.Desktop.Views.ProductAttributeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:ChronoPos.Desktop.Views.Controls"
             xmlns:converters="clr-namespace:ChronoPos.Desktop.Converters"
             xmlns:userControls="clr-namespace:ChronoPos.Desktop.UserControls"
             mc:Ignorable="d" 
             Background="{DynamicResource MainBackground}"
             FlowDirection="{Binding CurrentFlowDirection}"
             FontFamily="{DynamicResource PoppinsFontFallback}">

    <UserControl.Resources>
        <!-- Converters -->
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:FlowDirectionToGridColumnConverter x:Key="FlowDirectionToGridColumnConverter"/>
        <converters:FlowDirectionToHorizontalAlignmentConverter x:Key="FlowDirectionToHorizontalAlignmentConverter"/>
        <converters:BoolToGridLengthConverter x:Key="BoolToGridLengthConverter"/>
        <converters:BoolToYesNoConverter x:Key="BoolToYesNoConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>

        <!-- Button Style -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource Primary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="{DynamicResource BorderCornerRadius}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryDark}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryDarker}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="{DynamicResource BorderLight}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Delete Button Style -->
        <Style x:Key="DeleteButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="{DynamicResource Danger}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource DangerDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Edit Button Style -->
        <Style x:Key="EditButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="{DynamicResource Success}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SuccessDark}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <!-- Main Content Area - Always full width -->
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title and Icon -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ·ï¸" FontSize="32" VerticalAlignment="Center" Margin="0,0,15,0"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Product Attributes" 
                                 FontSize="{DynamicResource FontSizeLarge}" 
                                 FontWeight="Bold" 
                                 Foreground="{DynamicResource TextPrimary}"/>
                        <TextBlock Text="Manage product attributes and their values" 
                                 FontSize="{DynamicResource FontSizeSmall}" 
                                 Foreground="{DynamicResource TextSecondary}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Refresh Button -->
                    <controls:RefreshButton Width="120" Height="36" 
                                              ButtonText="Refresh"
                                              ButtonIcon="ðŸ”„"
                                              Command="{Binding RefreshDataCommand}"
                                              Margin="0,0,10,0"/>
                    
                    <!-- Add Attribute Value Button -->
                    <Button Style="{StaticResource ActionButtonStyle}"
                            Command="{Binding AddAttributeCommand}"
                            Width="140" Height="36">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âž•" FontSize="14" Margin="0,0,8,0"/>
                            <TextBlock Text="Add Value"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Search and Filters -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <Border Grid.Column="0" 
                        Background="{DynamicResource CardBackground}"
                        BorderBrush="{DynamicResource BorderNormal}"
                        BorderThickness="1"
                        CornerRadius="{DynamicResource BorderCornerRadius}"
                        Padding="12,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="16" 
                                 Foreground="{DynamicResource TextSecondary}" 
                                 VerticalAlignment="Center" Margin="0,0,10,0"/>
                        
                        <TextBox Grid.Column="1" 
                               Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                               FontSize="{DynamicResource FontSizeNormal}"
                               Background="Transparent"
                               BorderThickness="0"
                               VerticalAlignment="Center"
                               Tag="Search attributes..."/>
                        
                        <Button Grid.Column="2" 
                              Content="âœ–" 
                              Background="Transparent" 
                              BorderThickness="0"
                              FontSize="12"
                              Foreground="{DynamicResource TextSecondary}"
                              Command="{Binding ClearSearchCommand}"
                              Visibility="{Binding HasSearchText, Converter={StaticResource BoolToVisibilityConverter}}"
                              Cursor="Hand"/>
                    </Grid>
                </Border>

                <!-- Active Only Filter -->
                <CheckBox Grid.Column="1" 
                        Content="Active Only" 
                        IsChecked="{Binding ShowActiveOnly}"
                        VerticalAlignment="Center"
                        Margin="15,0,0,0"
                        FontSize="{DynamicResource FontSizeSmall}"/>

                <!-- Clear Filters -->
                <Button Grid.Column="2" 
                      Content="Clear Filters"
                      Style="{StaticResource ActionButtonStyle}"
                      Command="{Binding ClearFiltersCommand}"
                      Background="{DynamicResource TextSecondary}"
                      Width="100" Height="32"
                      Margin="10,0,0,0"/>
            </Grid>

            <!-- Data Grid -->
            <Border Grid.Row="2" 
                    Background="{DynamicResource CardBackground}"
                    BorderBrush="{DynamicResource BorderNormal}"
                    BorderThickness="1"
                    CornerRadius="{DynamicResource BorderCornerRadius}">
                <DataGrid ItemsSource="{Binding FilteredAttributeValues}"
                        SelectedItem="{Binding SelectedAttributeValue}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        CanUserDeleteRows="False"
                        CanUserReorderColumns="False"
                        CanUserResizeRows="False"
                        HeadersVisibility="Column"
                        GridLinesVisibility="Horizontal"
                        HorizontalGridLinesBrush="{DynamicResource BorderLight}"
                        Background="Transparent"
                        RowBackground="Transparent"
                        AlternatingRowBackground="{DynamicResource AlternateRowBackground}"
                        BorderThickness="0"
                        FontFamily="{DynamicResource PoppinsFontFallback}">

                    <DataGrid.Columns>
                        <!-- ID -->
                        <DataGridTextColumn Header="ID" 
                                          Binding="{Binding Id}" 
                                          Width="60"
                                          IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                                    <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Attribute Name -->
                        <DataGridTextColumn Header="Attribute Name" 
                                          Binding="{Binding AttributeName}" 
                                          Width="200"
                                          IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                                    <Setter Property="FontSize" Value="{DynamicResource FontSizeNormal}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Value Name -->
                        <DataGridTextColumn Header="Value Name" 
                                          Binding="{Binding Value}" 
                                          Width="200"
                                          IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                                    <Setter Property="FontSize" Value="{DynamicResource FontSizeNormal}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{DynamicResource Primary}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Arabic Value -->
                        <DataGridTextColumn Header="Arabic Value" 
                                          Binding="{Binding ValueAr}" 
                                          Width="150"
                                          IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                                    <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Type -->
                        <DataGridTextColumn Header="Type" 
                                          Binding="{Binding AttributeType}" 
                                          Width="100"
                                          IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                                    <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource Primary}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Required -->
                        <DataGridTemplateColumn Header="Required" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding IsRequired, Converter={StaticResource BoolToYesNoConverter}}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             FontFamily="{DynamicResource PoppinsFontFallback}"
                                             FontSize="{DynamicResource FontSizeSmall}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Status -->
                        <DataGridTemplateColumn Header="Status" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                            CornerRadius="12"
                                            Padding="8,3"
                                            HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Status}"
                                                 Foreground="White"
                                                 FontFamily="{DynamicResource PoppinsFontFallback}"
                                                 FontSize="{DynamicResource FontSizeExtraSmall}"
                                                 FontWeight="SemiBold"
                                                 HorizontalAlignment="Center"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Created Date -->
                        <DataGridTextColumn Header="Created" 
                                          Binding="{Binding CreatedAt, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                          Width="100"
                                          IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                                    <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Actions -->
                        <DataGridTemplateColumn Header="Actions" Width="180">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <!-- Edit Button -->
                                        <Button Content="Edit" 
                                              Style="{StaticResource EditButtonStyle}"
                                              Command="{Binding DataContext.EditAttributeValueCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              CommandParameter="{Binding}"
                                              Width="60" Height="28"
                                              Margin="0,0,5,0"/>
                                        
                                        <!-- Delete Button -->
                                        <Button Content="Delete" 
                                              Style="{StaticResource DeleteButtonStyle}"
                                              Command="{Binding DataContext.DeleteAttributeValueCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              CommandParameter="{Binding}"
                                              Width="60" Height="28"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- Status Bar -->
            <Grid Grid.Row="3" Margin="0,20,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                         Text="{Binding StatusMessage}" 
                         FontSize="{DynamicResource FontSizeSmall}"
                         Foreground="{DynamicResource TextSecondary}"
                         VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1" 
                         Text="{Binding AttributeCountText}" 
                         FontSize="{DynamicResource FontSizeSmall}"
                         Foreground="{DynamicResource TextSecondary}"
                         VerticalAlignment="Center"/>
            </Grid>
        </Grid>

        <!-- Side Panel Overlay - Direct child of root Grid for proper z-index -->
        <Border HorizontalAlignment="Right"
                VerticalAlignment="Stretch"
                Width="420"
                Background="{DynamicResource CardBackground}"
                BorderThickness="1,0,0,0"
                BorderBrush="{DynamicResource BorderLight}"
                Panel.ZIndex="1000"
                Visibility="{Binding IsSidePanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border.RenderTransform>
                <TranslateTransform x:Name="SidePanelTransform"/>
            </Border.RenderTransform>
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSidePanelVisible}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X"
                                                       From="420" To="0" Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.X"
                                                       From="0" To="420" Duration="0:0:0.2">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseIn"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="12" Opacity="0.3" Direction="180"/>
            </Border.Effect>
            
            <!-- Side Panel Content will be loaded dynamically -->
            <ContentControl Content="{Binding SidePanelContent}"/>
        </Border>

        <!-- Loading Overlay -->
        <Border Background="#80000000"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="{DynamicResource CardBackground}"
                        CornerRadius="10"
                        Padding="30">
                    <StackPanel HorizontalAlignment="Center">
                        <ProgressBar IsIndeterminate="True" 
                                   Width="200" Height="4"
                                   Background="{DynamicResource BorderLight}"
                                   Foreground="{DynamicResource Primary}"/>
                        <TextBlock Text="{Binding LoadingMessage}" 
                                 FontSize="{DynamicResource FontSizeNormal}"
                                 Foreground="{DynamicResource TextPrimary}"
                                 HorizontalAlignment="Center"
                                 Margin="0,15,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>