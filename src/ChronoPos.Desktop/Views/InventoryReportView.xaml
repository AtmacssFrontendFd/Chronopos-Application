<UserControl x:Class="ChronoPos.Desktop.Views.InventoryReportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:ChronoPos.Desktop.Converters"
             xmlns:controls="clr-namespace:ChronoPos.Desktop.Views.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="900" d:DesignWidth="1400"
             Background="{DynamicResource MainBackground}"
             FontFamily="{DynamicResource PoppinsFontFallback}"
             Loaded="UserControl_Loaded">

    <UserControl.Resources>
        <!-- Converters -->
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:LocalizationConverter x:Key="LocalizationConverter"/>
        
        <!-- Card Style - Theme Compatible -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="{DynamicResource BorderCornerRadius}"/>
            <Setter Property="Margin" Value="{DynamicResource DefaultMarginThickness}"/>
            <Setter Property="Padding" Value="{DynamicResource DefaultPaddingThickness}"/>
        </Style>

        <!-- Summary Card Style - Theme Compatible -->
        <Style x:Key="SummaryCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="{DynamicResource BorderCornerRadius}"/>
            <Setter Property="Padding" Value="20,16"/>
        </Style>

        <!-- Action Button Style - Theme Compatible -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource Primary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="{DynamicResource BorderCornerRadius}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource PrimaryAlt}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Primary}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="{DynamicResource BorderLight}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button Style - Theme Compatible -->
        <Style x:Key="SecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource SurfaceBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderLight}"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                               BorderBrush="{TemplateBinding BorderBrush}"
                               BorderThickness="{TemplateBinding BorderThickness}"
                               CornerRadius="{DynamicResource BorderCornerRadius}"
                               Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource OverlayBackground}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Input Style - Theme Compatible -->
        <Style x:Key="InputStyle" TargetType="Control">
            <Setter Property="Height" Value="38"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
        </Style>

        <!-- FormComboBoxStyle (matching Sales Report) -->
        <Style x:Key="FormComboBoxStyle" TargetType="ComboBox">
            <Setter Property="MinHeight" Value="38"/>
            <Setter Property="Padding" Value="{DynamicResource DefaultPaddingThickness}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderLight}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="MainBorder"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource BorderCornerRadius}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <ContentPresenter Grid.Column="0"
                                                    x:Name="PART_ContentPresenter"
                                                    Content="{TemplateBinding SelectionBoxItem}"
                                                    ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                    ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                    HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                    Margin="{TemplateBinding Padding}"
                                                    IsHitTestVisible="False"/>
                                    
                                    <Border Grid.Column="1"
                                            Width="24"
                                            Height="24"
                                            Background="{DynamicResource CardBackground}"
                                            BorderBrush="{DynamicResource BorderLight}"
                                            BorderThickness="1"
                                            CornerRadius="12"
                                            Margin="0,0,5,0"
                                            VerticalAlignment="Center">
                                        <ToggleButton x:Name="DropDownToggle"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                    ClickMode="Press"
                                                    Focusable="False"
                                                    Width="24"
                                                    Height="24">
                                            <TextBlock Text="â–¼"
                                                     FontSize="8"
                                                     FontFamily="{DynamicResource PoppinsFontFallback}"
                                                     Foreground="{DynamicResource TextSecondary}"
                                                     HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"/>
                                        </ToggleButton>
                                    </Border>
                                </Grid>
                            </Border>
                            
                            <Popup x:Name="PART_Popup"
                                   Placement="Bottom"
                                   PlacementTarget="{Binding ElementName=MainBorder}"
                                   IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Border Background="{DynamicResource CardBackground}"
                                        BorderBrush="{DynamicResource BorderLight}"
                                        BorderThickness="1"
                                        CornerRadius="{DynamicResource BorderCornerRadius}"
                                        MinWidth="{Binding ActualWidth, ElementName=MainBorder}"
                                        MaxHeight="200">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" Direction="270" BlurRadius="8" ShadowDepth="2" Opacity="0.3"/>
                                    </Border.Effect>
                                    <ScrollViewer x:Name="DropDownScrollViewer"
                                                VerticalScrollBarVisibility="Auto"
                                                HorizontalScrollBarVisibility="Disabled">
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="MainBorder" Property="BorderBrush" Value="{DynamicResource Primary}"/>
                                <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource CardBackground}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="MainBorder" Property="BorderBrush" Value="{DynamicResource Primary}"/>
                                <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource CardBackground}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource SurfaceBackground}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextDisabled}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="{DynamicResource DefaultPaddingThickness}"/>
                        <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
                        <Setter Property="FontFamily" Value="{DynamicResource PoppinsFontFallback}"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextSecondary}"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource OverlayBackground}"/>
                                <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Primary}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="20,15,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="Auto"/> <!-- Filters -->
                <RowDefinition Height="Auto"/> <!-- Summary Cards -->
                <RowDefinition Height="Auto"/> <!-- Data Grid -->
            </Grid.RowDefinitions>

            <!-- Header with Back Button -->
            <Grid Grid.Row="0" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Back Button and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Back Button - CircularBackButton Control -->
                    <controls:CircularBackButton 
                        Command="{Binding BackToReportsHubCommand}"
                        ButtonSize="30"
                        ButtonBackground="{DynamicResource SurfaceBackground}"
                        ButtonForeground="{DynamicResource TextSecondary}"
                        ButtonHoverBackground="{DynamicResource OverlayBackground}"
                        ButtonHoverForeground="{DynamicResource TextSecondary}"
                        Margin="0,0,15,0"/>

                    <StackPanel>
                        <TextBlock Text="Inventory Report" 
                                  FontSize="{DynamicResource FontSizeLarge}" 
                                  FontWeight="Bold"
                                  FontFamily="{DynamicResource PoppinsFontFallback}"
                                  Foreground="{DynamicResource TextPrimary}"/>
                        <TextBlock Text="Monitor stock levels, track inventory movements, and analyze stock valuation" 
                                  FontSize="{DynamicResource FontSizeSmall}" 
                                  Foreground="{DynamicResource TextSecondary}"
                                  Margin="0,4,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- Export Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="ðŸ“„ Excel" 
                           Command="{Binding ExportToExcelCommand}"
                           Style="{StaticResource SecondaryButtonStyle}"
                           Height="34"
                           Padding="12,8"
                           FontSize="12"
                           Margin="0,0,6,0"/>
                    <Button Content="ðŸ“Š CSV" 
                           Command="{Binding ExportToCsvCommand}"
                           Style="{StaticResource SecondaryButtonStyle}"
                           Height="34"
                           Padding="12,8"
                           FontSize="12"
                           Margin="0,0,6,0"/>
                    <Button Content="ðŸ“‹ PDF" 
                           Command="{Binding ExportToPdfCommand}"
                           Style="{StaticResource SecondaryButtonStyle}"
                           Height="34"
                           Padding="12,8"
                           FontSize="12"/>
                </StackPanel>
            </Grid>

            <!-- Filters Panel -->
            <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,0,0,20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Report Type Selection -->
                    <Grid Grid.Row="0" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Report Type" 
                                  FontSize="13" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource TextPrimary}"/>

                        <ComboBox Grid.Column="1"
                                 ItemsSource="{Binding ReportTypes}"
                                 SelectedValue="{Binding SelectedReportType}"
                                 SelectedValuePath="Type"
                                 DisplayMemberPath="Name"
                                 Style="{StaticResource InputStyle}"/>
                    </Grid>

                    <!-- Date Range and Product/Category Filters -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" 
                                  Text="Filters" 
                                  FontSize="13" 
                                  FontWeight="SemiBold"
                                  VerticalAlignment="Center"
                                  Foreground="{DynamicResource TextPrimary}"/>

                        <!-- Start Date -->
                        <controls:CustomDatePicker Grid.Column="1"
                                                  SelectedDate="{Binding FilterStartDate, Mode=TwoWay}"
                                                  Placeholder="Start Date"
                                                  ToolTip="Start Date"/>

                        <!-- End Date -->
                        <controls:CustomDatePicker Grid.Column="3"
                                                  SelectedDate="{Binding FilterEndDate, Mode=TwoWay}"
                                                  Placeholder="End Date"
                                                  ToolTip="End Date"/>

                        <!-- Product Filter -->
                        <ComboBox Grid.Column="5"
                                 ItemsSource="{Binding Products}"
                                 SelectedValue="{Binding SelectedProductId}"
                                 SelectedValuePath="Id"
                                 DisplayMemberPath="Name"
                                 Style="{StaticResource FormComboBoxStyle}"
                                 ToolTip="Select Product"/>

                        <!-- Category Filter -->
                        <ComboBox Grid.Column="7"
                                 ItemsSource="{Binding Categories}"
                                 SelectedValue="{Binding SelectedCategoryId}"
                                 SelectedValuePath="Id"
                                 DisplayMemberPath="Name"
                                 Style="{StaticResource FormComboBoxStyle}"
                                 ToolTip="Select Category"/>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="9" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Clear" 
                                   Command="{Binding ClearFiltersCommand}"
                                   Style="{StaticResource SecondaryButtonStyle}"
                                   Height="38"
                                   Padding="16,8"
                                   Margin="0,0,10,0"/>
                            <Button Content="Load Report" 
                                   Command="{Binding LoadReportDataCommand}"
                                   Style="{StaticResource ActionButtonStyle}"
                                   Height="38"
                                   Padding="16,8"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Summary Cards -->
            <Grid Grid.Row="2" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Stock Value -->
                <Border Grid.Column="0" Style="{StaticResource SummaryCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Stock Value" 
                                  FontSize="12" 
                                  Foreground="{DynamicResource TextSecondary}"/>
                        <TextBlock Text="{Binding TotalStockValue, StringFormat='{}{0:C}'}" 
                                  FontSize="24" 
                                  FontWeight="Bold" 
                                  Foreground="{DynamicResource Success}"
                                  Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Total Products -->
                <Border Grid.Column="2" Style="{StaticResource SummaryCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Total Products" 
                                  FontSize="12" 
                                  Foreground="{DynamicResource TextSecondary}"/>
                        <TextBlock Text="{Binding TotalProducts}" 
                                  FontSize="24" 
                                  FontWeight="Bold" 
                                  Foreground="{DynamicResource Info}"
                                  Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Low Stock Items -->
                <Border Grid.Column="4" Style="{StaticResource SummaryCardStyle}">
                    <StackPanel>
                        <TextBlock Text="Low Stock Items" 
                                  FontSize="12" 
                                  Foreground="{DynamicResource TextSecondary}"/>
                        <TextBlock Text="{Binding LowStockItems}" 
                                  FontSize="24" 
                                  FontWeight="Bold" 
                                  Foreground="{DynamicResource Warning}"
                                  Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Total Inward/Outward -->
                <Border Grid.Column="6" Style="{StaticResource SummaryCardStyle}">
                    <StackPanel>
                        <TextBlock Text="In/Out Movement" 
                                  FontSize="12" 
                                  Foreground="{DynamicResource TextSecondary}"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="{Binding TotalInwardQty, StringFormat='â†‘{0:N0}'}" 
                                      FontSize="16" 
                                      FontWeight="SemiBold" 
                                      Foreground="{DynamicResource Success}"
                                      Margin="0,0,10,0"/>
                            <TextBlock Text="{Binding TotalOutwardQty, StringFormat='â†“{0:N0}'}" 
                                      FontSize="16" 
                                      FontWeight="SemiBold" 
                                      Foreground="{DynamicResource Error}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Data Grid Area -->
            <Border Grid.Row="3" Style="{StaticResource CardStyle}">
                <Grid>
                    <!-- Loading Overlay -->
                    <Grid Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                         Background="{DynamicResource OverlayBackground}"
                         Opacity="0.9"
                         Panel.ZIndex="1000">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <ProgressBar IsIndeterminate="True" Width="200" Height="4" Margin="0,0,0,10"/>
                            <TextBlock Text="Loading report..." 
                                      FontSize="{DynamicResource FontSizeSmall}" 
                                      Foreground="{DynamicResource TextPrimary}"/>
                        </StackPanel>
                    </Grid>

                    <!-- Content based on selected report type -->
                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Style.Triggers>
                                    <!-- Stock Summary Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="StockSummary">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding StockSummaryData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         ColumnHeaderStyle="{StaticResource ReportColumnHeaderStyle}"
                                                         RowStyle="{StaticResource ReportRowStyle}"
                                                         CellStyle="{StaticResource ReportCellStyle}"
                                                         CanUserSortColumns="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Product Code" Binding="{Binding ProductCode}" Width="120">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportBoldTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding ProductName}" Width="*">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Unit" Binding="{Binding Unit}" Width="80">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Opening" Binding="{Binding OpeningStock, StringFormat=N2}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Inward" Binding="{Binding InwardQty, StringFormat=N2}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Outward" Binding="{Binding OutwardQty, StringFormat=N2}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Closing" Binding="{Binding ClosingStock, StringFormat=N2}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Unit Cost" Binding="{Binding UnitCost, StringFormat=C2}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Stock Value" Binding="{Binding StockValue, StringFormat=C2}" Width="120">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Stock Ledger Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="StockLedger">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding StockLedgerData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         ColumnHeaderStyle="{StaticResource ReportColumnHeaderStyle}"
                                                         RowStyle="{StaticResource ReportRowStyle}"
                                                         CellStyle="{StaticResource ReportCellStyle}">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Date" Binding="{Binding DateDisplay}" Width="120">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding ProductName}" Width="*">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportBoldTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Movement Type" Binding="{Binding TransactionTypeDisplay}" Width="140">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Reference Type" Binding="{Binding ReferenceTypeDisplay}" Width="140">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Reference" Binding="{Binding RefNo}" Width="120">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Location" Binding="{Binding LocationDisplay}" Width="120">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Inward" Binding="{Binding InQtyDisplay}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Outward" Binding="{Binding OutQtyDisplay}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Balance" Binding="{Binding BalanceDisplay}" Width="100">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportNumericCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                        <DataGridTextColumn Header="Remarks" Binding="{Binding RemarksDisplay}" Width="150">
                                                            <DataGridTextColumn.ElementStyle>
                                                                <Style TargetType="TextBlock" BasedOn="{StaticResource ReportTextCellStyle}"/>
                                                            </DataGridTextColumn.ElementStyle>
                                                        </DataGridTextColumn>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Stock Valuation Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="StockValuation">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding StockValuationData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Product Code" Binding="{Binding ProductCode}" Width="120"/>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150"/>
                                                        <DataGridTextColumn Header="Unit" Binding="{Binding Unit}" Width="80"/>
                                                        <DataGridTextColumn Header="Quantity" Binding="{Binding Quantity, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Unit Cost" Binding="{Binding UnitCost, StringFormat=C2}" Width="100"/>
                                                        <DataGridTextColumn Header="Total Value" Binding="{Binding TotalValue, StringFormat=C2}" Width="120"/>
                                                        <DataGridTextColumn Header="% of Total" Binding="{Binding PercentageOfTotal, StringFormat=N2}" Width="100"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Low Stock Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="LowStock">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding LowStockData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Product Code" Binding="{Binding ProductCode}" Width="120"/>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150"/>
                                                        <DataGridTextColumn Header="Current Qty" Binding="{Binding CurrentQty, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Reorder Level" Binding="{Binding ReorderLevel, StringFormat=N2}" Width="110"/>
                                                        <DataGridTextColumn Header="Shortage" Binding="{Binding Shortage, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Supplier" Binding="{Binding Supplier}" Width="150"/>
                                                        <DataGridTextColumn Header="Est. Reorder Value" Binding="{Binding EstimatedReorderValue, StringFormat=C2}" Width="140"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Goods Received Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="GoodsReceived">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding GoodsReceivedData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="GRN No" Binding="{Binding GrnNo}" Width="120"/>
                                                        <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat=dd/MM/yyyy}" Width="100"/>
                                                        <DataGridTextColumn Header="Supplier" Binding="{Binding Supplier}" Width="150"/>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Qty" Binding="{Binding Qty, StringFormat=N2}" Width="80"/>
                                                        <DataGridTextColumn Header="Unit Price" Binding="{Binding UnitPrice, StringFormat=C2}" Width="100"/>
                                                        <DataGridTextColumn Header="Total" Binding="{Binding Total, StringFormat=C2}" Width="120"/>
                                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                                        <DataGridTextColumn Header="Invoice No" Binding="{Binding InvoiceNo}" Width="120"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Stock Adjustment Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="StockAdjustment">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding StockAdjustmentData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat=dd/MM/yyyy}" Width="100"/>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Previous Qty" Binding="{Binding PreviousQty, StringFormat=N2}" Width="110"/>
                                                        <DataGridTextColumn Header="New Qty" Binding="{Binding NewQty, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Difference" Binding="{Binding Difference, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Reason" Binding="{Binding Reason}" Width="150"/>
                                                        <DataGridTextColumn Header="Note" Binding="{Binding Note}" Width="200"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Stock Transfer Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="StockTransfer">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding StockTransferData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Transfer No" Binding="{Binding TransferNo}" Width="120"/>
                                                        <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat=dd/MM/yyyy}" Width="100"/>
                                                        <DataGridTextColumn Header="From" Binding="{Binding FromLocation}" Width="150"/>
                                                        <DataGridTextColumn Header="To" Binding="{Binding ToLocation}" Width="150"/>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Qty" Binding="{Binding Qty, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Stock Aging Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="StockAging">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding StockAgingData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Batch No" Binding="{Binding BatchNo}" Width="120"/>
                                                        <DataGridTextColumn Header="Quantity" Binding="{Binding Quantity, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Purchase Date" Binding="{Binding PurchaseDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                                                        <DataGridTextColumn Header="Days in Stock" Binding="{Binding DaysInStock}" Width="110"/>
                                                        <DataGridTextColumn Header="Expiry Date" Binding="{Binding ExpiryDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                                                        <DataGridTextColumn Header="Days to Expiry" Binding="{Binding DaysToExpiry}" Width="120"/>
                                                        <DataGridTextColumn Header="Age Category" Binding="{Binding AgeCategory}" Width="120"/>
                                                        <DataGridTextColumn Header="Total Value" Binding="{Binding TotalValue, StringFormat=C2}" Width="120"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Goods Return Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="GoodsReturn">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding GoodsReturnData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Return No" Binding="{Binding ReturnNo}" Width="120"/>
                                                        <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat=dd/MM/yyyy}" Width="100"/>
                                                        <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                                                        <DataGridTextColumn Header="Supplier" Binding="{Binding Supplier}" Width="150"/>
                                                        <DataGridTextColumn Header="Product" Binding="{Binding Product}" Width="*"/>
                                                        <DataGridTextColumn Header="Qty" Binding="{Binding Qty, StringFormat=N2}" Width="80"/>
                                                        <DataGridTextColumn Header="Reason" Binding="{Binding Reason}" Width="150"/>
                                                        <DataGridTextColumn Header="Amount" Binding="{Binding Amount, StringFormat=C2}" Width="120"/>
                                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>

                                    <!-- Category Summary Report -->
                                    <DataTrigger Binding="{Binding SelectedReportType}" Value="CategorySummary">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DataGrid ItemsSource="{Binding InventorySummaryData}"
                                                         Style="{StaticResource ReportDataGridStyle}"
                                                         AutoGenerateColumns="False"
                                                         IsReadOnly="True">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="*"/>
                                                        <DataGridTextColumn Header="No of Items" Binding="{Binding NoOfItems}" Width="110"/>
                                                        <DataGridTextColumn Header="Total Qty" Binding="{Binding TotalQty, StringFormat=N2}" Width="110"/>
                                                        <DataGridTextColumn Header="Total Value" Binding="{Binding TotalValue, StringFormat=C2}" Width="120"/>
                                                        <DataGridTextColumn Header="Avg Cost" Binding="{Binding AvgCost, StringFormat=C2}" Width="110"/>
                                                        <DataGridTextColumn Header="% of Total" Binding="{Binding PercentageOfTotal, StringFormat=N2}" Width="100"/>
                                                        <DataGridTextColumn Header="Low Stock Items" Binding="{Binding LowStockItems}" Width="130"/>
                                                        <DataGridTextColumn Header="Out of Stock" Binding="{Binding OutOfStockItems}" Width="120"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
